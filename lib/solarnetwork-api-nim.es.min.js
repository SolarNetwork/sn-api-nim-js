import{UserUrlHelperMixin,UrlHelper,Environment}from"solarnetwork-api-core";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _construct(e,t,n){return(_construct=isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(o,n.prototype),o}).apply(null,arguments)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var SolarNodeImageGroup=function(){function e(t,n){_classCallCheck(this,e),this.componentId=t,this.componentName=n,this.items=[],this.groups=[],this.constructor===e&&Object.freeze(this)}return _createClass(e,[{key:"addItem",value:function(e){return this.items.push(e),this}},{key:"addGroup",value:function(e){return this.groups.push(e),this}},{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}}]),e}(),LOCALE_COMPARE_OPTIONS=Object.freeze({sensitivity:"base",numeric:!0}),DATE_LIKE_ENDING=/.*(\d{4})(\d{2})(\d{2})$/,SolarNodeImageInfo=function(){function e(t,n,r,o,i){_classCallCheck(this,e),this.id=t,this.sha256=n,this.contentLength=r,this.uncompressedSha256=o,this.uncompressedContentLength=i,this.constructor===e&&Object.freeze(this)}return _createClass(e,[{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}},{key:"displayNameForComponent",value:function(){if(!this.id)return"";var e=this.id.split("-");if(e.length<2)return this.id;var t=e[e.length-1],n=t.match(DATE_LIKE_ENDING);return n?n[1]+"-"+n[2]+"-"+n[3]:t}},{key:"hasId",value:function(e){return void 0!=this.id&&void 0!==e&&0===this.id.localeCompare(e,void 0,LOCALE_COMPARE_OPTIONS)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.id||""),n.push(r.sha256||""),n.push(r.contentLength||0),n.push(r.uncompressedSha256||""),n.push(r.uncompressedContentLength||0)}return _construct(e,n)}},{key:"compareById",value:function(e,t){var n=e?e.id:"",r=t?t.id:"";return n.localeCompare(r,void 0,LOCALE_COMPARE_OPTIONS)}},{key:"idComponentGroups",value:function(t){var n=Array.isArray(t)?t.slice():[];n.sort(e.compareById);var r=[],o={};function i(e){for(var t in o)if(0===t.localeCompare(e,void 0,LOCALE_COMPARE_OPTIONS))return o[t]}for(var s=0,a=n.length;s<a;s+=1){var u=n[s],c=u.id.split("-").slice(0,-1),l=i(c.join("-").toLowerCase());if(void 0===l)for(var p=0,h=c.length;p<h;p+=1){var f=c.slice(0,p+1).join("-").toLowerCase(),d=i(f);d||(d=new SolarNodeImageGroup(f,c[p]),o[f]=d,void 0!==l&&l.addGroup(d),0===p&&r.push(d)),l=d}l&&l.addItem(u)}return r}}]),e}(),SolarNodeImageOptions=function(){function e(t,n,r){_classCallCheck(this,e),this.environment=t,this.parameters=n,this.verbose=r}return _createClass(e,[{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.environment||void 0),n.push(r.parameters||void 0),n.push(r.verbose||void 0)}return _construct(e,n)}}]),e}(),SolarNodeImageReceipt=function(){function e(t,n,r,o,i,s,a,u,c,l,p,h){_classCallCheck(this,e),this.id=t,this.baseImageId=n,this.createdDate=r,this.started=o,this.done=i,this.cancelled=s,this.percentComplete=a,this.message=u,this.startedDate=c,this.completedDate=l,this.imageInfo=p,this.downloadUrl=h,this.constructor===e&&Object.freeze(this)}return _createClass(e,[{key:"toJsonEncoding",value:function(){var e=Object.assign({},this);return this.createdDate&&(e.createdDate=this.createdDate.getTime()),this.startedDate&&(e.startedDate=this.startedDate.getTime()),this.completedDate&&(e.completedDate=this.completedDate.getTime()),JSON.stringify(e)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.id||""),n.push(r.baseImageId||""),n.push(r.createdDate?new Date(r.createdDate):null),n.push(!!r.started),n.push(!!r.done),n.push(!!r.cancelled),n.push(r.percentComplete||0),n.push(r.message||""),n.push(r.startedDate?new Date(r.startedDate):null),n.push(r.completedDate?new Date(r.completedDate):null),n.push(r.imageInfo?SolarNodeImageInfo.fromJsonEncoding(JSON.stringify(r.imageInfo)):void 0),n.push(r.downloadUrl||"")}return _construct(e,n)}}]),e}(),NimDefaultPath="/solarnode-image-maker",NimPathKey="nimPath",NimApiPathV1="/api/v1",NimSessionKey="nimSessionKey",NimUrlHelperMixin=function(e){return function(t){function n(){for(var e,t=arguments.length,r=new Array(t),o=0;o<t;o++)r[o]=arguments[o];_classCallCheck(this,n);var i=r&&r[0]?r[0]instanceof Environment?r[0]:new Environment(r[0]):new Environment({tls:!0,host:"apps.solarnetwork.net",port:443,nimPath:NimDefaultPath});return r||(r=[]),r[0]=i,_possibleConstructorReturn(this,(e=_getPrototypeOf(n)).call.apply(e,[this].concat(_toConsumableArray(r))))}return _inherits(n,e),_createClass(n,[{key:"baseUrl",value:function(){var e=this.env(NimPathKey),t=void 0!==e?e:NimDefaultPath;return this.hostUrl()+t+NimApiPathV1}},{key:"pingUrl",value:function(){return this.baseUrl()+"/ping"}},{key:"authorizeImageSessionUrl",value:function(){return this.baseUrl()+"/images/authorize"}},{key:"listBaseImagesUrl",value:function(){return this.baseUrl()+"/images/infos"}},{key:"createImageUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/create/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"createImageReceiptUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/receipt/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"downloadImageUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"nimSessionKey",get:function(){return this.parameter(NimSessionKey)},set:function(e){this.parameter(NimSessionKey,e)}}]),n}()},NimUrlHelper=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,NimUrlHelperMixin(UserUrlHelperMixin(UrlHelper))),t}();export{NimApiPathV1,NimDefaultPath,NimPathKey,NimUrlHelper,NimUrlHelperMixin,SolarNodeImageGroup,SolarNodeImageInfo,SolarNodeImageOptions,SolarNodeImageReceipt};