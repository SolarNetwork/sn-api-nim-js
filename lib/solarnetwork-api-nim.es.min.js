import{Environment,UrlHelper,UserUrlHelperMixin}from"solarnetwork-api-core";var classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),inherits=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},SolarNodeImageGroup=function(){function e(t,n){classCallCheck(this,e),this.componentId=t,this.componentName=n,this.items=[],this.groups=[],this.constructor===e&&Object.freeze(this)}return createClass(e,[{key:"addItem",value:function(e){return this.items.push(e),this}},{key:"addGroup",value:function(e){return this.groups.push(e),this}},{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}}]),e}(),LOCALE_COMPARE_OPTIONS=Object.freeze({sensitivity:"base",numeric:!0}),DATE_LIKE_ENDING=/.*(\d{4})(\d{2})(\d{2})$/,SolarNodeImageInfo=function(){function e(t,n,r,i,o){classCallCheck(this,e),this.id=t,this.sha256=n,this.contentLength=r,this.uncompressedSha256=i,this.uncompressedContentLength=o,this.constructor===e&&Object.freeze(this)}return createClass(e,[{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}},{key:"displayNameForComponent",value:function(){if(!this.id)return"";var e=this.id.split("-");if(e.length<2)return this.id;var t=e[e.length-1],n=t.match(DATE_LIKE_ENDING);return n?n[1]+"-"+n[2]+"-"+n[3]:t}},{key:"hasId",value:function(e){return void 0!=this.id&&void 0!==e&&0===this.id.localeCompare(e,void 0,LOCALE_COMPARE_OPTIONS)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.id||""),n.push(r.sha256||""),n.push(r.contentLength||0),n.push(r.uncompressedSha256||""),n.push(r.uncompressedContentLength||0)}return new(Function.prototype.bind.apply(e,[null].concat(n)))}},{key:"compareById",value:function(e,t){var n=e?e.id:"",r=t?t.id:"";return n.localeCompare(r,void 0,LOCALE_COMPARE_OPTIONS)}},{key:"idComponentGroups",value:function(t){var n=Array.isArray(t)?t.slice():[];n.sort(e.compareById);var r=[],i={};function o(e){for(var t in i)if(0===t.localeCompare(e,void 0,LOCALE_COMPARE_OPTIONS))return i[t]}for(var a=0,s=n.length;a<s;a+=1){var u=n[a],l=u.id.split("-").slice(0,-1),c=o(l.join("-").toLowerCase());if(void 0===c)for(var h=0,p=l.length;h<p;h+=1){var m=l.slice(0,h+1).join("-").toLowerCase(),d=o(m);d||(d=new SolarNodeImageGroup(m,l[h]),i[m]=d,void 0!==c&&c.addGroup(d),0===h&&r.push(d)),c=d}c&&c.addItem(u)}return r}}]),e}(),SolarNodeImageOptions=function(){function e(t,n,r){classCallCheck(this,e),this.environment=t,this.parameters=n,this.verbose=r}return createClass(e,[{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.environment||void 0),n.push(r.parameters||void 0),n.push(r.verbose||void 0)}return new(Function.prototype.bind.apply(e,[null].concat(n)))}}]),e}(),SolarNodeImageReceipt=function(){function e(t,n,r,i,o,a,s,u,l,c,h,p){classCallCheck(this,e),this.id=t,this.baseImageId=n,this.createdDate=r,this.started=i,this.done=o,this.cancelled=a,this.percentComplete=s,this.message=u,this.startedDate=l,this.completedDate=c,this.imageInfo=h,this.downloadUrl=p,this.constructor===e&&Object.freeze(this)}return createClass(e,[{key:"toJsonEncoding",value:function(){var e=Object.assign({},this);return this.createdDate&&(e.createdDate=this.createdDate.getTime()),this.startedDate&&(e.startedDate=this.startedDate.getTime()),this.completedDate&&(e.completedDate=this.completedDate.getTime()),JSON.stringify(e)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.id||""),n.push(r.baseImageId||""),n.push(r.createdDate?new Date(r.createdDate):null),n.push(!!r.started),n.push(!!r.done),n.push(!!r.cancelled),n.push(r.percentComplete||0),n.push(r.message||""),n.push(r.startedDate?new Date(r.startedDate):null),n.push(r.completedDate?new Date(r.completedDate):null),n.push(r.imageInfo?SolarNodeImageInfo.fromJsonEncoding(JSON.stringify(r.imageInfo)):void 0),n.push(r.downloadUrl||"")}return new(Function.prototype.bind.apply(e,[null].concat(n)))}}]),e}(),NimDefaultPath="/solarnode-image-maker",NimPathKey="nimPath",NimApiPathV1="/api/v1",NimSessionKey="nimSessionKey",NimUrlHelperMixin=function(e){return function(t){function n(){for(var e,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];classCallCheck(this,n);var o=r&&r[0]?r[0]instanceof Environment?r[0]:new Environment(r[0]):new Environment({tls:!0,host:"apps.solarnetwork.net",port:443,nimPath:NimDefaultPath});return r||(r=[]),r[0]=o,possibleConstructorReturn(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(toConsumableArray(r))))}return inherits(n,e),createClass(n,[{key:"baseUrl",value:function(){var e=this.env(NimPathKey),t=void 0!==e?e:NimDefaultPath;return this.hostUrl()+t+NimApiPathV1}},{key:"pingUrl",value:function(){return this.baseUrl()+"/ping"}},{key:"authorizeImageSessionUrl",value:function(){return this.baseUrl()+"/images/authorize"}},{key:"listBaseImagesUrl",value:function(){return this.baseUrl()+"/images/infos"}},{key:"createImageUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/create/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"createImageReceiptUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/receipt/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"downloadImageUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"nimSessionKey",get:function(){return this.parameter(NimSessionKey)},set:function(e){this.parameter(NimSessionKey,e)}}]),n}()},NimUrlHelper=function(e){function t(){return classCallCheck(this,t),possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return inherits(t,e),t}(NimUrlHelperMixin(UserUrlHelperMixin(UrlHelper)));export{SolarNodeImageGroup,SolarNodeImageInfo,SolarNodeImageOptions,SolarNodeImageReceipt,NimUrlHelperMixin,NimDefaultPath,NimPathKey,NimApiPathV1,NimUrlHelper};