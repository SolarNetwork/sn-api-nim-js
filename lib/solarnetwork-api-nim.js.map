{"version":3,"file":"solarnetwork-api-nim.js","sources":["../src/domain/SolarNodeImageGroup.js","../src/domain/SolarNodeImageInfo.js","../src/domain/SolarNodeImageOptions.js","../src/domain/SolarNodeImageReceipt.js","../src/net/NimUrlHelperMixin.js"],"sourcesContent":["/** @module domain */\n\n/**\n * A grouping of image infos, to support a hierarchy of images.\n */\nclass SolarNodeImageGroup {\n  /**\n   * Constructor.\n   *\n   * @param {string} componentId the full group component ID\n   * @param {string} componentName the last component from the component ID\n   */\n  constructor(componentId, componentName) {\n    /**\n     * The full group component ID.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.componentId = componentId;\n\n    /**\n     * The last component from the component ID.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.componentName = componentName;\n\n    /**\n     * The items of this group.\n     *\n     * @type {module:domain~SolarNodeImageInfo[]}\n     * @readonly\n     */\n    this.items = [];\n\n    /**\n     * The child groups of this group.\n     *\n     * @type {module:domain~SolarNodeImageGroup[]}\n     * @readonly\n     */\n    this.groups = [];\n\n    if (this.constructor === SolarNodeImageGroup) {\n      Object.freeze(this);\n    }\n  }\n\n  /**\n   * Add an image to this group.\n   *\n   * @param {module:domain~SolarNodeImageInfo} image the image to add\n   * @returns {module:domain~SolarNodeImageGroup} this object\n   */\n  addItem(image) {\n    this.items.push(image);\n    return this;\n  }\n\n  /**\n   * Add another group as a child of this group.\n   *\n   * @param {module:domain~SolarNodeImageGroup} group the group to add\n   * @returns {module:domain~SolarNodeImageGroup} this object\n   */\n  addGroup(group) {\n    this.groups.push(group);\n    return this;\n  }\n\n  /**\n   * Get this object as a standard JSON encoded string value.\n   *\n   * @return {string} the JSON encoded string\n   */\n  toJsonEncoding() {\n    return JSON.stringify(this);\n  }\n}\n\nexport default SolarNodeImageGroup;\n","/** @module domain */\n\nimport SolarNodeImageGroup from \"./SolarNodeImageGroup\";\n\n/** A locale options object suitable for passing to `String.localeCompare()`. */\nconst LOCALE_COMPARE_OPTIONS = Object.freeze({\n  sensitivity: \"base\",\n  numeric: true\n});\n\n/** A regexp that looks for 8 digits at the end of the string, assuming that is a YYYYMMDD date. */\nconst DATE_LIKE_ENDING = /.*(\\d{4})(\\d{2})(\\d{2})$/;\n\n/**\n * An immutable NIM image info object.\n */\nclass SolarNodeImageInfo {\n  /**\n   * Constructor.\n   *\n   * @param {string} id a unique identifier for this image\n   * @param {string} sha256 hex-encoded SHA-256 digest of the image content\n   * @param {number} contentLength the content length of the image content, in bytes\n   * @param {string} uncompressedSha256 a hex-encoded SHA-256 digest of the image contents when uncompressed\n   * @param {number} uncompressedContentLength the size of the image contents when uncompressed, in bytes\n   */\n  constructor(id, sha256, contentLength, uncompressedSha256, uncompressedContentLength) {\n    /**\n     * A unique identifier for this image.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.id = id;\n\n    /**\n     * A hex-encoded SHA-256 digest of the image content.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.sha256 = sha256;\n\n    /**\n     * The content length of the image content, in bytes.\n     *\n     * @type {number}\n     * @readonly\n     */\n    this.contentLength = contentLength;\n\n    /**\n     * A hex-encoded SHA-256 digest of the image contents when uncompressed.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.uncompressedSha256 = uncompressedSha256;\n\n    /**\n     * The size of the image contents when uncompressed, in bytes.\n     *\n     * @type {number}\n     * @readonly\n     */\n    this.uncompressedContentLength = uncompressedContentLength;\n\n    if (this.constructor === SolarNodeImageInfo) {\n      Object.freeze(this);\n    }\n  }\n\n  /**\n   * Get this object as a standard JSON encoded string value.\n   *\n   * @return {string} the JSON encoded string\n   */\n  toJsonEncoding() {\n    return JSON.stringify(this);\n  }\n\n  /**\n   * Get a display name based on the most specific component of this image's `id` value.\n   *\n   * The components of the `id` are based on splitting it on a `-` character. This method\n   * returns the right-most component. If that component has a date-like structure, the\n   * date will be formatted slightly.\n   *\n   * @returns {string} the display name\n   */\n  displayNameForComponent() {\n    if (!this.id) {\n      return \"\";\n    }\n    const components = this.id.split(\"-\");\n    if (components.length < 2) {\n      return this.id;\n    }\n    const name = components[components.length - 1];\n    const match = name.match(DATE_LIKE_ENDING);\n    if (match) {\n      return match[1] + \"-\" + match[2] + \"-\" + match[3];\n    }\n    return name;\n  }\n\n  /**\n   * Parse a JSON string into a {@link module:domain~SolarNodeImageInfo} instance.\n   *\n   * The JSON must be encoded the same way {@link module:domain~SolarNodeImageInfo#toJsonEncoding} does.\n   *\n   * @param {string|Object} json the JSON to parse, or a parsed JSON object\n   * @returns {module:domain~SolarNodeImageInfo} the session instance\n   */\n  static fromJsonEncoding(json) {\n    const args = [];\n    if (json) {\n      const obj = typeof json === \"string\" ? JSON.parse(json) : json;\n      args.push(obj.id || \"\");\n      args.push(obj.sha256 || \"\");\n      args.push(obj.contentLength || 0);\n      args.push(obj.uncompressedSha256 || \"\");\n      args.push(obj.uncompressedContentLength || 0);\n    }\n    return new SolarNodeImageInfo(...args);\n  }\n\n  /**\n   * Compare an ID value with this object's ID value.\n   *\n   * This method performs a case-insensitive compare similar to {@link module:domain~SolarNodeImageInfo#compareById}.\n   *\n   * @param {string} id an ID value to compare\n   * @returns {boolean} `true` if `id` matches this object's `id`\n   */\n  hasId(id) {\n    if (this.id == undefined || id === undefined) {\n      return false;\n    }\n    return this.id.localeCompare(id, undefined, LOCALE_COMPARE_OPTIONS) === 0;\n  }\n\n  /**\n   * Compare two `SolarNodeImageInfo` objects based on their IDs.\n   *\n   * The `id` values are compared in a case-insensitive manner, using a natural number ordering.\n   *\n   * @param {SolarNodeImageInfo} l the left-hand object to compare\n   * @param {SolarNodeImageInfo} r the right-hand object to compare\n   * @returns {number} < `0` if `l` sorts before `r`, > `0` if `l` sorts after `r`, or `0` if `l` and `r` sort equally\n   */\n  static compareById(l, r) {\n    const lId = l ? l.id : \"\";\n    const rId = r ? r.id : \"\";\n    return lId.localeCompare(rId, undefined, LOCALE_COMPARE_OPTIONS);\n  }\n\n  /**\n   * Take an array of `SolarNodeImageInfo` objects and split them into a hierarchy based on\n   * the components of their IDs.\n   *\n   * The ID components are derived by splitting the `id` values on a `-` (dash) character.\n   * They are then grouped going from left to right by component.\n   *\n   * @param {SolarNodeImageInfo[]} imageList the image infos to get a hierarchy for\n   * @returns {module:domain~SolarNodeImageGroup[]} the hierarchy as a list of groups\n   */\n  static idComponentGroups(imageList) {\n    const sortedImageList = Array.isArray(imageList) ? imageList.slice() : [];\n    sortedImageList.sort(SolarNodeImageInfo.compareById);\n    const rootGroups = [];\n    let groupMap = {};\n\n    /**\n     * Get a cached group by ID.\n     * @param {string} id the ID of the group to get\n     * @returns {SolarNodeImageGroup} the group, or `undefined`\n     */\n    function getGroup(id) {\n      for (let oneId in groupMap) {\n        if (oneId.localeCompare(id, undefined, LOCALE_COMPARE_OPTIONS) === 0) {\n          return groupMap[oneId];\n        }\n      }\n      return undefined;\n    }\n\n    for (let i = 0, len = sortedImageList.length; i < len; i += 1) {\n      let image = sortedImageList[i];\n      let groupIdComponents = image.id.split(\"-\").slice(0, -1);\n      let groupComponentId = groupIdComponents.join(\"-\").toLowerCase();\n      let group = getGroup(groupComponentId);\n      if (group === undefined) {\n        for (let j = 0, len = groupIdComponents.length; j < len; j += 1) {\n          let componentId = groupIdComponents\n            .slice(0, j + 1)\n            .join(\"-\")\n            .toLowerCase();\n          let parentGroup = getGroup(componentId);\n          if (!parentGroup) {\n            parentGroup = new SolarNodeImageGroup(componentId, groupIdComponents[j]);\n            groupMap[componentId] = parentGroup;\n            if (group !== undefined) {\n              group.addGroup(parentGroup);\n            }\n            if (j === 0) {\n              rootGroups.push(parentGroup);\n            }\n          }\n          group = parentGroup;\n        }\n      }\n      // group _should_ be set here\n      if (group) {\n        group.addItem(image);\n      }\n    }\n    return rootGroups;\n  }\n}\n\nexport default SolarNodeImageInfo;\n","/** @module domain */\n\n/**\n * A NIM options object.\n */\nclass SolarNodeImageOptions {\n  /**\n   * Constructor.\n   *\n   * @param {object} environment environment parameters to pass to the customization process\n   * @param {object} parameters parameters to pass to the customization process\n   * @param {boolean} verbose `true` to output verbose information during the customization process\n   */\n  constructor(environment, parameters, verbose) {\n    /**\n     * Environment parameters to pass to the customization process.\n     *\n     * The keys and values will be treated as strings.\n     *\n     * @type {object}\n     */\n    this.environment = environment;\n\n    /**\n     * Parameters to pass to the customization process.\n     *\n     * @type {object}\n     */\n    this.parameters = parameters;\n\n    /**\n     * A flag to toggle producing verbose information during the customization process.\n     *\n     * @type {boolean}\n     */\n    this.verbose = verbose;\n  }\n\n  /**\n   * Get this object as a standard JSON encoded string value.\n   *\n   * @return {string} the JSON encoded string\n   */\n  toJsonEncoding() {\n    return JSON.stringify(this);\n  }\n\n  /**\n   * Parse a JSON string into a {@link module:domain~SolarNodeImageOptions} instance.\n   *\n   * The JSON must be encoded the same way {@link module:domain~SolarNodeImageOptions#toJsonEncoding} does.\n   *\n   * @param {string|Object} json the JSON to parse, or a parsed JSON object\n   * @returns {module:domain~SolarNodeImageOptions} the session instance\n   */\n  static fromJsonEncoding(json) {\n    const args = [];\n    if (json) {\n      const obj = typeof json === \"string\" ? JSON.parse(json) : json;\n      args.push(obj.environment || undefined);\n      args.push(obj.parameters || undefined);\n      args.push(obj.verbose || undefined);\n    }\n    return new SolarNodeImageOptions(...args);\n  }\n}\n\nexport default SolarNodeImageOptions;\n","/** @module domain */\n\nimport SolarNodeImageInfo from \"./SolarNodeImageInfo\";\n\n/**\n * An immutable NIM receipt object.\n */\nclass SolarNodeImageReceipt {\n  /**\n   * Constructor.\n   *\n   * @param {string} id a unique ID for this work task\n   * @param {string} baseImageId the ID of the image that served as the starting point for this customized image\n   * @param {Date} createdDate the date the task was created\n   * @param {boolean} started flag indicating if the task has started executing\n   * @param {boolean} done flag indicating if the task has completed executing\n   * @param {boolean} cancelled flag indicating if the task was cancelled before executing completely\n   * @param {number} percentComplete the amount of work that has been completed, as a fractional percentage between `0` and `1`\n   * @param {string} message a status message\n   * @param {Date} [startedDate] the date the customization task started executing\n   * @param {Date} [completedDate] the date the customization task completed executing\n   * @param {SolarNodeImageInfo} [imageInfo] information about the final image, once ready\n   * @param {string} [downloadUrl] a URL for a direct download of the finished image\n   *\n   */\n  constructor(\n    id,\n    baseImageId,\n    createdDate,\n    started,\n    done,\n    cancelled,\n    percentComplete,\n    message,\n    startedDate,\n    completedDate,\n    imageInfo,\n    downloadUrl\n  ) {\n    /**\n     * A unique ID for this work task.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.id = id;\n\n    /**\n     * The ID of the image that served as the starting point for this customized image.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.baseImageId = baseImageId;\n\n    /**\n     * The date the task was created.\n     *\n     * @type {Date}\n     * @readonly\n     */\n    this.createdDate = createdDate;\n\n    /**\n     * A flag indicating if the task has started executing.\n     *\n     * @type {boolean}\n     * @readonly\n     */\n    this.started = started;\n\n    /**\n     * A flag indicating if the task has completed executing.\n     *\n     * @type {boolean}\n     * @readonly\n     */\n    this.done = done;\n\n    /**\n     * A flag indicating if the task task was cancelled before executing completely.\n     *\n     * @type {boolean}\n     * @readonly\n     */\n    this.cancelled = cancelled;\n\n    /**\n     * The amount of work that has been completed, as a fractional percentage between `0` and `1`.\n     *\n     * @type {number}\n     * @readonly\n     */\n    this.percentComplete = percentComplete;\n\n    /**\n     * A status message.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.message = message;\n\n    /**\n     * The date the customization task started executing.\n     *\n     * @type {Date}\n     * @readonly\n     */\n    this.startedDate = startedDate;\n\n    /**\n     * The date the customization task completed executing.\n     *\n     * @type {Date}\n     * @readonly\n     */\n    this.completedDate = completedDate;\n\n    /**\n     * Information about the final image, once ready.\n     *\n     * @type {SolarNodeImageInfo}\n     * @readonly\n     */\n    this.imageInfo = imageInfo;\n\n    /**\n     * A URL for a direct download of the finished image.\n     *\n     * @type {string}\n     * @readonly\n     */\n    this.downloadUrl = downloadUrl;\n\n    if (this.constructor === SolarNodeImageReceipt) {\n      Object.freeze(this);\n    }\n  }\n\n  /**\n   * Get this object as a standard JSON encoded string value.\n   *\n   * @return {string} the JSON encoded string\n   */\n  toJsonEncoding() {\n    var d = Object.assign({}, this);\n    if (this.createdDate) {\n      d.createdDate = this.createdDate.getTime();\n    }\n    if (this.startedDate) {\n      d.startedDate = this.startedDate.getTime();\n    }\n    if (this.completedDate) {\n      d.completedDate = this.completedDate.getTime();\n    }\n    return JSON.stringify(d);\n  }\n\n  /**\n   * Parse a JSON string into a {@link module:domain~SolarNodeImageReceipt} instance.\n   *\n   * The JSON must be encoded the same way {@link module:domain~SolarNodeImageReceipt#toJsonEncoding} does.\n   *\n   * @param {string|Object} json the JSON to parse, or a parsed JSON object\n   * @returns {module:domain~SolarNodeImageReceipt} the session instance\n   */\n  static fromJsonEncoding(json) {\n    const args = [];\n    if (json) {\n      const obj = typeof json === \"string\" ? JSON.parse(json) : json;\n      args.push(obj.id || \"\");\n      args.push(obj.baseImageId || \"\");\n      args.push(obj.createdDate ? new Date(obj.createdDate) : null);\n      args.push(!!obj.started);\n      args.push(!!obj.done);\n      args.push(!!obj.cancelled);\n      args.push(obj.percentComplete || 0);\n      args.push(obj.message || \"\");\n      args.push(obj.startedDate ? new Date(obj.startedDate) : null);\n      args.push(obj.completedDate ? new Date(obj.completedDate) : null);\n      args.push(\n        obj.imageInfo\n          ? SolarNodeImageInfo.fromJsonEncoding(JSON.stringify(obj.imageInfo))\n          : undefined\n      );\n      args.push(obj.downloadUrl || \"\");\n    }\n    return new SolarNodeImageReceipt(...args);\n  }\n}\n\nexport default SolarNodeImageReceipt;\n","/** @module net */\n\nimport { Environment, UrlHelper, UserUrlHelperMixin } from \"solarnetwork-api-core\";\n\n/** The NIM default path. */\nexport const NimDefaultPath = \"/solarnode-image-maker\";\n\n/** The {@link UrlHelper} parameters key for the NIM path. */\nexport const NimPathKey = \"nimPath\";\n\n/** The NIM REST API path. */\nexport const NimApiPathV1 = \"/api/v1\";\n\n/** An {@link UrlHelper} parameter key for a NIM session key. */\nexport const NimSessionKey = \"nimSessionKey\";\n\n/**\n * Create a NimUrlHelperMixin class.\n *\n * @exports net\n * @param {UrlHelper} superclass the UrlHelper class to mix onto\n * @return {module:net~NimUrlHelperMixin} the mixin class\n */\nconst NimUrlHelperMixin = superclass =>\n  /**\n   * A mixin class that adds NIM specific support to {@link UrlHelper}.\n   *\n   * @mixin\n   * @alias module:net~NimUrlHelperMixin\n   */\n  class extends superclass {\n    /**\n     * Constructor.\n     *\n     * @param {*} args any number of arguments, but the first argument is assumed to be either an {@link Environment}\n     *                 instance or a simple object that serves as the NIM environment\n     */\n    constructor(...args) {\n      const env =\n        args && args[0]\n          ? args[0] instanceof Environment\n            ? args[0]\n            : new Environment(args[0])\n          : new Environment({\n              tls: true,\n              host: \"apps.solarnetwork.net\",\n              port: 443,\n              nimPath: NimDefaultPath\n            });\n      if (!args) {\n        args = [];\n      }\n      args[0] = env;\n      super(...args);\n    }\n\n    /**\n     * Get the base URL to the NIM v1 REST API.\n     *\n     * The returned URL uses the configured environment to resolve the `hostUrl` and the `nimPath`\n     * context path.\n     *\n     * @returns {string} the base URL to NIM\n     */\n    baseUrl() {\n      const nimPath = this.env(NimPathKey);\n      const path = nimPath !== undefined ? nimPath : NimDefaultPath;\n      return this.hostUrl() + path + NimApiPathV1;\n    }\n\n    /**\n     * A NIM session key.\n     *\n     * Configuring this value is a convenient way to avoid having to pass the key to many of the\n     * `*Url` methods that require this value.\n     *\n     * @type {string}\n     */\n    get nimSessionKey() {\n      return this.parameter(NimSessionKey);\n    }\n\n    set nimSessionKey(sessionKey) {\n      this.parameter(NimSessionKey, sessionKey);\n    }\n\n    /**\n     * Generate a URL for the \"ping\" health test URL.\n     *\n     * @returns {string} the URL\n     */\n    pingUrl() {\n      return this.baseUrl() + \"/ping\";\n    }\n\n    /**\n     * Generate a URL for authorizing a new NIM session.\n     *\n     * @returns {string} the URL\n     */\n    authorizeImageSessionUrl() {\n      return this.baseUrl() + \"/images/authorize\";\n    }\n\n    /**\n     * Generate a URL for listing the available base images.\n     *\n     * @returns {string} the URL\n     */\n    listBaseImagesUrl() {\n      return this.baseUrl() + \"/images/infos\";\n    }\n\n    /**\n     * Generate a URL for creating a custom image.\n     *\n     * @param {string}  imageId the ID of the base image to customize\n     * @param {string} [sessionKey] the session key returned from a call to `/images/authorize`; if not provided the {@link module:net~NimUrlHelperMixin#nimSessionKey} value will be used\n     * @returns {string} the URL\n     */\n    createImageUrl(imageId, sessionKey) {\n      const key = sessionKey || this.nimSessionKey;\n      return (\n        this.baseUrl() +\n        \"/images/create/\" +\n        encodeURIComponent(imageId) +\n        \"/\" +\n        encodeURIComponent(key)\n      );\n    }\n\n    /**\n     * Generate a URL for getting a receipt for an image creation request.\n     *\n     * @param {string}  receiptId the ID of the image creation receipt returned from a call to `/images/create/{imageId}/{sessionKey}`\n     * @param {string} [sessionKey] the session key returned from a call to `/images/authorize`; if not provided the {@link module:net~NimUrlHelperMixin#nimSessionKey} value will be used\n     * @returns {string} the URL\n     */\n    createImageReceiptUrl(receiptId, sessionKey) {\n      const key = sessionKey || this.nimSessionKey;\n      return (\n        this.baseUrl() +\n        \"/images/receipt/\" +\n        encodeURIComponent(receiptId) +\n        \"/\" +\n        encodeURIComponent(key)\n      );\n    }\n\n    /**\n     * Generate a URL for downloading a completed image file.\n     *\n     * @param {string}  receiptId the ID of the image creation receipt returned from a call to `/images/create/{imageId}/{sessionKey}`\n     * @param {string} [sessionKey] the session key returned from a call to `/images/authorize`; if not provided the {@link module:net~NimUrlHelperMixin#nimSessionKey} value will be used\n     * @returns {string} the URL\n     */\n    downloadImageUrl(receiptId, sessionKey) {\n      const key = sessionKey || this.nimSessionKey;\n      return (\n        this.baseUrl() + \"/images/\" + encodeURIComponent(receiptId) + \"/\" + encodeURIComponent(key)\n      );\n    }\n  };\n\n/**\n * A concrete {@link UrlHelper} with the {@link module:net~NimUrlHelperMixin} and\n * {@link UserUrlHelperMixin} mixins.\n *\n * @mixes NimUrlHelperMixin\n * @mixes UserUrlHelperMixin\n * @extends UrlHelper\n */\nclass NimUrlHelper extends NimUrlHelperMixin(UserUrlHelperMixin(UrlHelper)) {}\n\nexport default NimUrlHelperMixin;\nexport { NimUrlHelper };\n"],"names":["SolarNodeImageGroup","componentId","componentName","items","groups","constructor","Object","freeze","image","push","group","JSON","stringify","LOCALE_COMPARE_OPTIONS","sensitivity","numeric","DATE_LIKE_ENDING","SolarNodeImageInfo","id","sha256","contentLength","uncompressedSha256","uncompressedContentLength","components","split","length","name","match","undefined","localeCompare","json","args","obj","parse","l","r","lId","rId","imageList","sortedImageList","Array","isArray","slice","sort","compareById","rootGroups","groupMap","getGroup","oneId","i","len","groupIdComponents","groupComponentId","join","toLowerCase","j","parentGroup","addGroup","addItem","SolarNodeImageOptions","environment","parameters","verbose","SolarNodeImageReceipt","baseImageId","createdDate","started","done","cancelled","percentComplete","message","startedDate","completedDate","imageInfo","downloadUrl","d","assign","getTime","Date","fromJsonEncoding","NimDefaultPath","NimPathKey","NimApiPathV1","NimSessionKey","NimUrlHelperMixin","superclass","env","Environment","tls","host","port","nimPath","path","hostUrl","baseUrl","imageId","sessionKey","key","nimSessionKey","encodeURIComponent","receiptId","parameter","NimUrlHelper","UserUrlHelperMixin","UrlHelper"],"mappings":"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"}