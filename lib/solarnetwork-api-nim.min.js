!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("solarnetwork-api-core")):"function"==typeof define&&define.amd?define(["exports","solarnetwork-api-core"],t):t(e.sn=e.sn||{},e.sn)}(this,function(e,t){"use strict";var n=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},s=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},a=function(){function e(t,r){n(this,e),this.componentId=t,this.componentName=r,this.items=[],this.groups=[],this.constructor===e&&Object.freeze(this)}return r(e,[{key:"addItem",value:function(e){return this.items.push(e),this}},{key:"addGroup",value:function(e){return this.groups.push(e),this}},{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}}]),e}(),u=Object.freeze({sensitivity:"base",numeric:!0}),c=/.*(\d{4})(\d{2})(\d{2})$/,p=function(){function e(t,r,i,o,s){n(this,e),this.id=t,this.sha256=r,this.contentLength=i,this.uncompressedSha256=o,this.uncompressedContentLength=s,this.constructor===e&&Object.freeze(this)}return r(e,[{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}},{key:"displayNameForComponent",value:function(){if(!this.id)return"";var e=this.id.split("-");if(e.length<2)return this.id;var t=e[e.length-1],n=t.match(c);return n?n[1]+"-"+n[2]+"-"+n[3]:t}},{key:"hasId",value:function(e){return void 0!=this.id&&void 0!==e&&0===this.id.localeCompare(e,void 0,u)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.id||""),n.push(r.sha256||""),n.push(r.contentLength||0),n.push(r.uncompressedSha256||""),n.push(r.uncompressedContentLength||0)}return new(Function.prototype.bind.apply(e,[null].concat(n)))}},{key:"compareById",value:function(e,t){var n=e?e.id:"",r=t?t.id:"";return n.localeCompare(r,void 0,u)}},{key:"idComponentGroups",value:function(t){var n=Array.isArray(t)?t.slice():[];n.sort(e.compareById);var r=[],i={};function o(e){for(var t in i)if(0===t.localeCompare(e,void 0,u))return i[t]}for(var s=0,c=n.length;s<c;s+=1){var p=n[s],h=p.id.split("-").slice(0,-1),l=o(h.join("-").toLowerCase());if(void 0===l)for(var f=0,d=h.length;f<d;f+=1){var m=h.slice(0,f+1).join("-").toLowerCase(),y=o(m);y||(y=new a(m,h[f]),i[m]=y,void 0!==l&&l.addGroup(y),0===f&&r.push(y)),l=y}l&&l.addItem(p)}return r}}]),e}(),h=function(){function e(t,r,i){n(this,e),this.environment=t,this.parameters=r,this.verbose=i}return r(e,[{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.environment||void 0),n.push(r.parameters||void 0),n.push(r.verbose||void 0)}return new(Function.prototype.bind.apply(e,[null].concat(n)))}}]),e}(),l=function(){function e(t,r,i,o,s,a,u,c,p,h,l,f){n(this,e),this.id=t,this.baseImageId=r,this.createdDate=i,this.started=o,this.done=s,this.cancelled=a,this.percentComplete=u,this.message=c,this.startedDate=p,this.completedDate=h,this.imageInfo=l,this.downloadUrl=f,this.constructor===e&&Object.freeze(this)}return r(e,[{key:"toJsonEncoding",value:function(){var e=Object.assign({},this);return this.createdDate&&(e.createdDate=this.createdDate.getTime()),this.startedDate&&(e.startedDate=this.startedDate.getTime()),this.completedDate&&(e.completedDate=this.completedDate.getTime()),JSON.stringify(e)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.id||""),n.push(r.baseImageId||""),n.push(r.createdDate?new Date(r.createdDate):null),n.push(!!r.started),n.push(!!r.done),n.push(!!r.cancelled),n.push(r.percentComplete||0),n.push(r.message||""),n.push(r.startedDate?new Date(r.startedDate):null),n.push(r.completedDate?new Date(r.completedDate):null),n.push(r.imageInfo?p.fromJsonEncoding(JSON.stringify(r.imageInfo)):void 0),n.push(r.downloadUrl||"")}return new(Function.prototype.bind.apply(e,[null].concat(n)))}}]),e}(),f="/solarnode-image-maker",d=function(e){return function(a){function u(){for(var e,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];n(this,u);var c=i&&i[0]?i[0]instanceof t.Environment?i[0]:new t.Environment(i[0]):new t.Environment({tls:!0,host:"apps.solarnetwork.net",port:443,nimPath:f});return i||(i=[]),i[0]=c,o(this,(e=u.__proto__||Object.getPrototypeOf(u)).call.apply(e,[this].concat(s(i))))}return i(u,e),r(u,[{key:"baseUrl",value:function(){var e=this.env("nimPath")||f;return this.hostUrl()+e+"/api/v1"}},{key:"pingUrl",value:function(){return this.baseUrl()+"/ping"}},{key:"authorizeImageSessionUrl",value:function(){return this.baseUrl()+"/images/authorize"}},{key:"listBaseImagesUrl",value:function(){return this.baseUrl()+"/images/infos"}},{key:"createImageUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/create/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"createImageReceiptUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/receipt/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"downloadImageUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"nimSessionKey",get:function(){return this.parameter("nimSessionKey")},set:function(e){this.parameter("nimSessionKey",e)}}]),u}()},m=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),t}(d(t.UserUrlHelperMixin(t.UrlHelper)));e.SolarNodeImageGroup=a,e.SolarNodeImageInfo=p,e.SolarNodeImageOptions=h,e.SolarNodeImageReceipt=l,e.NimUrlHelperMixin=d,e.NimDefaultPath=f,e.NimPathKey="nimPath",e.NimApiPathV1="/api/v1",e.NimUrlHelper=m,Object.defineProperty(e,"__esModule",{value:!0})});