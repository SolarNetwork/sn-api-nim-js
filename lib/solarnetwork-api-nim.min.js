!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("solarnetwork-api-core")):"function"==typeof define&&define.amd?define(["exports","solarnetwork-api-core"],t):t((e=e||self).sn={},e.sn)}(this,function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t,n){return(u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&a(i,n.prototype),i}).apply(null,arguments)}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var p=function(){function e(t,r){n(this,e),this.componentId=t,this.componentName=r,this.items=[],this.groups=[],this.constructor===e&&Object.freeze(this)}return i(e,[{key:"addItem",value:function(e){return this.items.push(e),this}},{key:"addGroup",value:function(e){return this.groups.push(e),this}},{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}}]),e}(),f=Object.freeze({sensitivity:"base",numeric:!0}),h=/.*(\d{4})(\d{2})(\d{2})$/,d=function(){function e(t,r,i,o,s){n(this,e),this.id=t,this.sha256=r,this.contentLength=i,this.uncompressedSha256=o,this.uncompressedContentLength=s,this.constructor===e&&Object.freeze(this)}return i(e,[{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}},{key:"displayNameForComponent",value:function(){if(!this.id)return"";var e=this.id.split("-");if(e.length<2)return this.id;var t=e[e.length-1],n=t.match(h);return n?n[1]+"-"+n[2]+"-"+n[3]:t}},{key:"hasId",value:function(e){return void 0!=this.id&&void 0!==e&&0===this.id.localeCompare(e,void 0,f)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.id||""),n.push(r.sha256||""),n.push(r.contentLength||0),n.push(r.uncompressedSha256||""),n.push(r.uncompressedContentLength||0)}return u(e,n)}},{key:"compareById",value:function(e,t){var n=e?e.id:"",r=t?t.id:"";return n.localeCompare(r,void 0,f)}},{key:"idComponentGroups",value:function(t){var n=Array.isArray(t)?t.slice():[];n.sort(e.compareById);var r=[],i={};function o(e){for(var t in i)if(0===t.localeCompare(e,void 0,f))return i[t]}for(var s=0,a=n.length;s<a;s+=1){var u=n[s],c=u.id.split("-").slice(0,-1),l=o(c.join("-").toLowerCase());if(void 0===l)for(var h=0,d=c.length;h<d;h+=1){var m=c.slice(0,h+1).join("-").toLowerCase(),y=o(m);y||(y=new p(m,c[h]),i[m]=y,void 0!==l&&l.addGroup(y),0===h&&r.push(y)),l=y}l&&l.addItem(u)}return r}}]),e}(),m=function(){function e(t,r,i){n(this,e),this.environment=t,this.parameters=r,this.verbose=i}return i(e,[{key:"toJsonEncoding",value:function(){return JSON.stringify(this)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.environment||void 0),n.push(r.parameters||void 0),n.push(r.verbose||void 0)}return u(e,n)}}]),e}(),y=function(){function e(t,r,i,o,s,a,u,c,l,p,f,h){n(this,e),this.id=t,this.baseImageId=r,this.createdDate=i,this.started=o,this.done=s,this.cancelled=a,this.percentComplete=u,this.message=c,this.startedDate=l,this.completedDate=p,this.imageInfo=f,this.downloadUrl=h,this.constructor===e&&Object.freeze(this)}return i(e,[{key:"toJsonEncoding",value:function(){var e=Object.assign({},this);return this.createdDate&&(e.createdDate=this.createdDate.getTime()),this.startedDate&&(e.startedDate=this.startedDate.getTime()),this.completedDate&&(e.completedDate=this.completedDate.getTime()),JSON.stringify(e)}}],[{key:"fromJsonEncoding",value:function(t){var n=[];if(t){var r="string"==typeof t?JSON.parse(t):t;n.push(r.id||""),n.push(r.baseImageId||""),n.push(r.createdDate?new Date(r.createdDate):null),n.push(!!r.started),n.push(!!r.done),n.push(!!r.cancelled),n.push(r.percentComplete||0),n.push(r.message||""),n.push(r.startedDate?new Date(r.startedDate):null),n.push(r.completedDate?new Date(r.completedDate):null),n.push(r.imageInfo?d.fromJsonEncoding(JSON.stringify(r.imageInfo)):void 0),n.push(r.downloadUrl||"")}return u(e,n)}}]),e}(),v="/solarnode-image-maker",g=function(e){return function(r){function a(){for(var e,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n(this,a);var u=i&&i[0]?i[0]instanceof t.Environment?i[0]:new t.Environment(i[0]):new t.Environment({tls:!0,host:"apps.solarnetwork.net",port:443,nimPath:v});return i||(i=[]),i[0]=u,c(this,(e=s(a)).call.apply(e,[this].concat(l(i))))}return o(a,e),i(a,[{key:"baseUrl",value:function(){var e=this.env("nimPath"),t=void 0!==e?e:v;return this.hostUrl()+t+"/api/v1"}},{key:"pingUrl",value:function(){return this.baseUrl()+"/ping"}},{key:"authorizeImageSessionUrl",value:function(){return this.baseUrl()+"/images/authorize"}},{key:"listBaseImagesUrl",value:function(){return this.baseUrl()+"/images/infos"}},{key:"createImageUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/create/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"createImageReceiptUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/receipt/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"downloadImageUrl",value:function(e,t){var n=t||this.nimSessionKey;return this.baseUrl()+"/images/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)}},{key:"nimSessionKey",get:function(){return this.parameter("nimSessionKey")},set:function(e){this.parameter("nimSessionKey",e)}}]),a}()},b=function(e){function r(){return n(this,r),c(this,s(r).apply(this,arguments))}return o(r,g(t.UserUrlHelperMixin(t.UrlHelper))),r}();e.NimApiPathV1="/api/v1",e.NimDefaultPath=v,e.NimPathKey="nimPath",e.NimUrlHelper=b,e.NimUrlHelperMixin=g,e.SolarNodeImageGroup=p,e.SolarNodeImageInfo=d,e.SolarNodeImageOptions=m,e.SolarNodeImageReceipt=y,Object.defineProperty(e,"__esModule",{value:!0})});